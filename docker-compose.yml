volumes:
  vol-airflow:
  vol-postgres:
  vol-mongodb:
  vol-metabase:
  vol-minio:
  vol-spark-apps:
  vol-spark-data:
  vol-spark-logs:
  vol-portainer:
  vol-prometheus:
  vol-loki:
  vol-tempo:
  vol-grafana:
  vol-redis:
  vol-smtp:
  vol-rabbitmq:
  vol-clickhouse:
  vol-neo4j:
  vol-chroma:
  vol-ollama:
  vol-open-webui:

networks:
  docker_network:

#================================================================================
# X-DEFINITIONS (COMMON CONFIGURATIONS)
#================================================================================

x-airflow-common: &airflow-common
  build:
    dockerfile: ./docker/airflow/Dockerfile
  user: "${AIRFLOW_UID}:0"
  environment:
    AIRFLOW_UID: "${AIRFLOW_UID}"
  env_file:
    - ./.env
    - ./docker/airflow/.env
  volumes:
    - ./data/airflow/dags:/opt/airflow/dags
    - ./data/airflow/logs:/opt/airflow/logs
    - ./data/airflow/downloads:/opt/airflow/downloads
    - ./data/airflow/plugins:/opt/airflow/plugins
    - /var/run/docker.sock:/var/run/docker.sock
    - ./data/airflow/spark-jars:/opt/airflow/spark-jars
  networks:
    - docker_network

x-airflow-depends-on: &airflow-depends-on
  depends_on:
    postgres-server:
      condition: service_healthy
    airflow-init-app:
      condition: service_completed_successfully

x-spark-common: &spark-common
  build: ./docker/spark
  image: spark-cluster:3.4.1
  volumes:
    - vol-spark-apps:/opt/spark-apps
    - vol-spark-data:/opt/spark-data
    - vol-spark-logs:/opt/spark/spark-events
  env_file:
    - ./.env
    - ./docker/spark/.env
  networks:
    - docker_network

#================================================================================
# SERVICES
#================================================================================

# Services have been moved to separate compose files for better organization:
# - docker-compose.databases.yml: Core databases and storage
# - docker-compose.processing.yml: Data processing and orchestration
# - docker-compose.ai.yml: AI and ML services
# - docker-compose.observability.yml: Observability and monitoring
# - docker-compose.management.yml: Management and UI tools
#
# To run all services: docker-compose -f docker-compose.databases.yml -f docker-compose.processing.yml -f docker-compose.ai.yml -f docker-compose.observability.yml -f docker-compose.management.yml up -d
# Or run individual stacks as needed.
